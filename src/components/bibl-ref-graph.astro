
<div class="lg:grid grid-cols-[1fr_4fr] gap-3 lg:p-10 p-3 border rounded-lg bg-brand-50 shadow-2xl">
  <div class="text-brand-700 prose">
    <h2 class="text-2xl font-semibold mb-4 text-brand-950">Biblical References Network</h2>
    <p>Lorem ipsum dolor sit amet ...</p>
  </div>
    <div
        id="bibl-graph"
        class="w-full"
        style={`height: 900px; width: 100%;`}
    >
  </div>
</div>

<script>
  import * as echarts from "echarts";
  import { withBasePath } from "../lib/withBasePath";
  import biblref from "@/content/data/biblical_references.json";


document.addEventListener("DOMContentLoaded", () => {
  const chartElement = document.getElementById("bibl-graph");
  if (!chartElement) return;

  const chart = echarts.init(chartElement);
  chart.showLoading();

  const worksMap = new Map();
  const nodes = new Map();
  const links: any[] = [];
  const genres = new Set<string>();

  // -------------------------
  // BUILD DATA
  // -------------------------

  for (const ref of biblref) {
    nodes.set(ref.jad_id, {
      id: ref.jad_id,
      name: ref.name,
      category: "Biblical reference",
      symbolSize: 40,
      value: ref.name
    });

    for (const passage of ref.related_passages ?? []) {
      for (const work of passage.work ?? []) {
        const genre = work.genre || "Unknown";

        if (!worksMap.has(work.jad_id)) {
          worksMap.set(work.jad_id, work);

          genres.add(genre);

          nodes.set(work.jad_id, {
            id: work.jad_id,
            name: `${work.author[0].name}: ${work.title}`,
            category: genre,
            symbolSize: 20,
            value: work.title
          });
        }

        links.push({
          source: ref.jad_id,
          target: work.jad_id
        });
      }
    }
  }

  // -------------------------
  // PREPARE CATEGORIES using genres
  // -------------------------

  const categories = [
    { name: "Biblical reference" },
    ...Array.from(genres).map(g => ({ name: g }))
  ];

  chart.hideLoading();

  // -------------------------
  // OPTION
  // -------------------------

  const option = {
    title: {
      text: "Biblical References Network",
      left: "center"
    },
     tooltip: {
            trigger: "item",
            textStyle: { fontSize: 12 ,
                fontWeight: 'bold'
            },
            
            formatter: function (params: any) {
                return params.data.name;
                },
        },
    legend: [
      {
        data: categories.map(c => c.name)
      }
    ],
    series: [
      {
        type: "graph",
        layout: "force",
        roam: true,
        force: {
          repulsion: 200,
          edgeLength: 120
        },
        data: Array.from(nodes.values()),
        links: links,
        categories: categories,
        label: {
          show: true,
          position: "right"
        },
        lineStyle: {
          width: 1,
          curveness: 0.2
        },
        emphasis: {
          focus: "adjacency"
        }
      }
    ]
  };

  chart.setOption(option);

  window.addEventListener("resize", () => chart.resize());
});
</script>