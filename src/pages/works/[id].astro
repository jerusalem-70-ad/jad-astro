---
import PageLayout from "../../layouts/page-layout.astro";
import { getCollection } from "astro:content";

// make a function to read the collection; 'export' make the function available for Astro'S static site generation. 

export async function getStaticPaths() {
    // 1) Use getCollection to fetch the json file
    const works = await getCollection("works")
    return works.map(work => {
        // for each entry in the collection we get params to generate the static pages - in this case the slug 'id' matches the value of 'work.id' 
        return { params: {id: work.id},
        // props is Astro specific - we use the props for the page content below
                props: {data: work.data}}
   })
}

const { data: work } = Astro.props;

---
<PageLayout>  
   
    <div>
        <div class="border-2 rounded-sm border-brandBrown bg-brandRose my-10 grid p-5 w-3/4 mx-auto">
            <h1 class="text-xl py-3 mx-auto font-medium">({work.id}) <span class="italic">{work.title}</span></h1>
            <dl class="grid grid-cols-[1fr_5fr] text-sm md:leading-7 md:text-base">  
                
                <dt class="font-semibold border-r border-gray-300 pr-5">Author:</dt>
                <dd class="pl-5">
                    {work.author && work.author.length > 0
                    ? work.author[0]?.name
                    : 'N/A'}
                </dd>
                
                <dt class="font-semibold border-r border-gray-300 pr-5">Manuscripts:</dt>                
                <dd class="pl-5">
                    { work.manuscripts.length > 0
                            ? work.manuscripts.map((ms: { id: string; value: any;}, index: number) => (
                                <>
                                <a href={`/manuscripts/jad_manuscript__${ms.id}`} class="hover:text-brandRed">
                                    {ms.value}
                                </a>
                                {/* to get comma after each entry BUT the last one (Index increments with each iteration, at the end it is equals to the length of the array -1) */}
                                {index < work.manuscripts.length - 1 && '| '}
                                </>
                            )) : 'N/A'
                        }
                </dd>
                    
                <dt class="font-semibold border-r border-gray-300 pr-5">Genre:</dt>                        
                <dd class="pl-5">
                    {work.genre && work.genre.lenght > 0
                    ? work.genre?.value
                    : 'N/A'}
                </dd>
                
                <dt class="font-semibold border-r border-gray-300 pr-5">Edition:</dt>                        
                <dd class="pl-5">
                    { work.published_edition.length > 0
                            ? work.published_edition.map((ed: { name: string; digi_url: any;}, index: number) => (
                                <>
                                {ed.digi_url.length > 0
                                ? <a href={ed.digi_url} class="hover:text-brandRed">
                                    {ed.name}
                                </a>
                                : ed.name
                                }
                               
                                {/* to get comma after each entry BUT the last one (Index increments with each iteration, at the end it is equals to the length of the array -1) */}
                                {index < work.published_edition.length - 1 && '| '}
                                </>
                            )) : 'N/A'
                        }
                </dd>
                
                <dt class="font-semibold border-r border-gray-300 pr-5">Institutional context:</dt>                        
                <dd class="pl-5">
                    {work.institutional_context.length > 0
                    ? work.institutional_context.map((institution : { name : string;}, index: number) => (
                        <>
                         <a href="/" class="hover:text-brandRed">
                                    {institution.name}
                                </a>
                        {index < work.institutional_context.lenght -1 && '| '}
                        </>
                    )) : 'N/A'
                }
                    
                </dd>
               
                
                <dt class="font-semibold border-r border-gray-300 pr-5">Date:</dt> 
                <dd class="pl-5">
                    { work.written_date.length > 0 
                    ? work.written_date 
                    : 'N/A' } 
                </dd>
            </dl> 
                
        </div>     
        <div class="my-10 flex p-5 w-3/4 mx-auto justify-between">
            {work.id > 1
            ? 
            <a href=`/works/jad_work__${parseInt(work.jad_id.split('__')[1]) -1}`><img src="/previous.svg" class="h-20"></a>
            : ''
        }
            
            <a href=`/works/jad_work__${parseInt(work.jad_id.split('__')[1]) +1}`><img src="/next.svg" class="h-20"></a>
           
              
        </div>   
        
    </div>

</PageLayout>
  